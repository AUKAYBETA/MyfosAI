<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Text→Video Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px auto;
      max-width: 700px;
    }
    textarea, input {
      width:100%;
      padding:8px;
      margin-top:8px;
      border-radius:4px;
      border:1px solid #ccc;
    }
    button {
      margin-top:12px;
      padding:10px 18px;
      background:#007bff;
      color:white;
      border:none;
      border-radius:4px;
      cursor:pointer;
    }
    button:hover {
      background:#0056b3;
    }
    video {
      display:block;
      margin-top:20px;
      width:100%;
      border:1px solid #ccc;
    }
    #status {
      margin-top:12px;
      font-weight:bold;
    }
  </style>
</head>
<body>

  <h1>Text → Video Demo</h1>

  <label>Prompt:</label>
  <textarea id="prompt">A cinematic drone shot of mountains during sunset, gentle camera motion</textarea>

  <label>Model ID:</label>
  <input id="model" value="Wan-AI/Wan2.2-TI2V-5B" />

  <label>HF API Token:</label>
  <input id="token" type="password" placeholder="hf_xxx" />

  <button id="generate">Generate Video</button>

  <div id="status"></div>

  <video id="preview" controls></video>

  <script>
    document.getElementById('generate').addEventListener('click', async () => {
      const prompt = document.getElementById('prompt').value.trim();
      const model = document.getElementById('model').value.trim();
      const token = document.getElementById('token').value.trim();
      const statusEl = document.getElementById('status');
      const videoEl = document.getElementById('preview');

      if (!prompt || !model || !token) {
        statusEl.textContent = "⚠️ All fields are required.";
        return;
      }

      statusEl.textContent = "⏳ Generating video… please wait.";
      videoEl.removeAttribute('src');

      try {
        const response = await fetch(`https://api-inference.huggingface.co/models/${model}`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            inputs: prompt,
            parameters: {
              num_frames: 16,
              guidance_scale: 7.5
            }
          })
        });

        if (!response.ok) {
          const errText = await response.text();
          throw new Error(`API error: ${errText}`);
        }

        const ct = response.headers.get('content-type') || '';
        if (ct.includes('application/json')) {
          const data = await response.json();
          if (data.video_base64) {
            const bin = atob(data.video_base64);
            const arr = new Uint8Array(bin.length);
            for (let i = 0; i < bin.length; i++) arr[i] = bin.charCodeAt(i);
            const blob = new Blob([arr.buffer], { type: 'video/mp4' });
            videoEl.src = URL.createObjectURL(blob);
            statusEl.textContent = "✅ Video generated!";
          } else {
            statusEl.textContent = "⚠️ Model returned JSON but no video.";
            console.log(data);
          }
        } else {
          const blob = await response.blob();
          videoEl.src = URL.createObjectURL(blob);
          statusEl.textContent = "✅ Video generated!";
        }
      } catch (err) {
        console.error(err);
        statusEl.textContent = `❌ ${err.message}`;
      }
    });
  </script>

</body>
</html>
